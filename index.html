<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FireGuard Elite | IntegratCore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');
        :root { --bg: #020617; --accent: #2563eb; --glass: rgba(15, 23, 42, 0.9); }
        body { background: var(--bg); color: #f1f5f9; font-family: 'Plus Jakarta Sans', sans-serif; }
        .glass-card { background: var(--glass); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; }
        .input-master { background: rgba(30, 41, 59, 0.7); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 12px; color: #fff; width: 100%; font-size: 13px; }
        .sidebar { position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: #0f172a; z-index: 4000; transition: 0.4s; border-right: 1px solid rgba(255,255,255,0.1); }
        .sidebar.active { left: 0; }
        .btn-master { background: linear-gradient(135deg, #2563eb, #1e40af); padding: 14px; border-radius: 14px; font-weight: 800; text-transform: uppercase; width: 100%; }
        .admin-only { display: none; }
    </style>
</head>
<body>

    <div id="loginGate" class="fixed inset-0 z-[5000] bg-slate-950 flex items-center justify-center p-6">
        <div class="w-full max-w-sm text-center">
            <h2 class="text-3xl font-black italic mb-8">FIRE<span class="text-blue-500">GUARD</span></h2>
            <div class="glass-card p-8">
                <input type="password" id="passInput" class="input-master text-center text-2xl mb-4 tracking-widest" placeholder="••••">
                <button onclick="access()" class="btn-master text-xs text-white">Entrar al Sistema</button>
            </div>
        </div>
    </div>

    <nav id="sidebar" class="sidebar p-8">
        <div class="flex justify-between items-center mb-10">
            <span class="text-xs font-black text-blue-500 uppercase italic">IntegratCore Menu</span>
            <button onclick="toggleMenu()"><i class="fas fa-times"></i></button>
        </div>
        <div class="bg-blue-600/10 p-4 rounded-xl text-center mb-6 border border-blue-500/20">
            <p class="text-[9px] text-blue-400 font-bold uppercase">Sesión activa como:</p>
            <p id="welcomeMsg" class="text-xs font-black text-white uppercase tracking-wider">--</p>
        </div>
        <div class="space-y-4">
            <button onclick="toggleMenu()" class="w-full flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 font-bold"><i class="fas fa-home"></i> Inicio</button>
            <button onclick="Swal.fire('Proximamente','Modulo de Reportes en desarrollo','info')" class="w-full flex items-center gap-4 p-4 rounded-xl hover:bg-white/5 font-bold"><i class="fas fa-file-invoice-dollar"></i> Historial Pagos</button>
            <hr class="border-white/5">
            <button onclick="logout()" class="w-full flex items-center gap-4 p-4 rounded-xl bg-red-500/10 text-red-500 font-bold"><i class="fas fa-power-off"></i> Cerrar Sesión</button>
        </div>
    </nav>

    <main id="appContent" class="hidden min-h-screen p-4 lg:p-10 max-w-[1600px] mx-auto">
        <header class="flex justify-between items-center mb-10">
            <button onclick="toggleMenu()" class="w-12 h-12 glass-card flex items-center justify-center text-blue-500"><i class="fas fa-bars"></i></button>
            <div class="text-center">
                <h1 class="text-xl font-black italic">GLOBAL DASHBOARD</h1>
                <span id="roleBadge" class="text-[9px] bg-blue-600/20 text-blue-400 px-3 py-1 rounded-full font-black uppercase">--</span>
            </div>
            <div id="capitalBox" class="admin-only glass-card px-6 py-3 border-l-4 border-l-blue-600">
                <p class="text-[8px] font-bold text-blue-500 uppercase">Capital Total</p>
                <p id="totalCap" class="text-lg font-black italic">RD$ 0</p>
            </div>
        </header>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
            <section class="xl:col-span-4">
                <div class="glass-card p-6 sticky top-8">
                    <h3 class="text-[10px] font-black text-blue-500 uppercase mb-6 flex items-center gap-2 italic">
                        <i class="fas fa-shield-check"></i> Registro de Documentación Real
                    </h3>
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="text" id="fn" class="input-master" placeholder="Nombre">
                            <input type="text" id="ln" class="input-master" placeholder="Apellido">
                        </div>
                        <select id="docType" class="input-master font-bold" onchange="checkDoc()">
                            <option value="Cedula">Cédula (Frente/Atrás)</option>
                            <option value="Licencia">Licencia (Frente/Atrás)</option>
                            <option value="Pasaporte">Pasaporte (Pág. Principal)</option>
                        </select>
                        <input type="text" id="docId" class="input-master" placeholder="Número de Documento">
                        
                        <div class="grid grid-cols-2 gap-2">
                            <select id="country" class="input-master">
                                <option value="1">RD (+1)</option>
                                <option value="599">Curazao (+599)</option>
                                <option value="507">Panamá (+507)</option>
                            </select>
                            <input type="tel" id="tel" class="input-master" placeholder="WhatsApp">
                        </div>

                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="amt" class="input-master text-blue-400 font-bold" placeholder="Monto">
                            <input type="number" id="ins" class="input-master font-bold" placeholder="Cuotas">
                        </div>

                        <div class="p-4 bg-black/30 rounded-xl space-y-3 border border-white/5">
                            <div><label class="text-[8px] font-black text-slate-500 uppercase">Foto Equipo</label><input type="file" id="fEq" class="text-[9px] w-full"></div>
                            <div id="frontBox"><label class="text-[8px] font-black text-blue-500 uppercase">Documento Frente</label><input type="file" id="fFr" class="text-[9px] w-full"></div>
                            <div id="backBox"><label class="text-[8px] font-black text-blue-500 uppercase">Documento Reverso</label><input type="file" id="fBk" class="text-[9px] w-full"></div>
                        </div>

                        <button id="saveBtn" onclick="saveClient()" class="btn-master text-[10px] text-white">Sincronizar Maestro</button>
                    </div>
                </div>
            </section>

            <section class="xl:col-span-8">
                <div class="glass-card overflow-hidden">
                    <div class="p-4 bg-white/5 flex justify-between items-center border-b border-white/10">
                        <input type="text" id="find" onkeyup="filtering()" class="input-master max-w-xs" placeholder="Buscar expediente...">
                        <div class="flex items-center gap-2"><span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> <span class="text-[10px] font-bold">LIVE</span></div>
                    </div>
                    <div class="overflow-x-auto p-4">
                        <table class="w-full text-left border-separate border-spacing-y-3">
                            <tbody id="mainList"></tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAmr8KHEyoaI3-xhKGy-uDUzCc8JkEzO6g", authDomain: "fireguard-4327f.firebaseapp.com", projectId: "fireguard-4327f", storageBucket: "fireguard-4327f.firebasestorage.app", messagingSenderId: "277545925255", appId: "1:277545925255:web:92175f4ac71dc9278b1622" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const MASTER = "FireMoney2026$";
        const PARTNER = "Curazao2026*";

        function access() {
            const p = document.getElementById('passInput').value;
            if(p === MASTER || p === PARTNER) {
                const role = p === MASTER ? 'ADMIN' : 'PARTNER';
                const name = p === MASTER ? 'ADMINISTRADOR MASTER' : 'PARTNER AGENT';
                localStorage.setItem('role', role);
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('appContent').classList.remove('hidden');
                document.getElementById('roleBadge').innerText = name;
                document.getElementById('welcomeMsg').innerText = name;
                if(role === 'ADMIN') document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'block');
                init();
            } else { Swal.fire('Error', 'Clave Inválida', 'error'); }
        }

        function logout() { localStorage.clear(); location.reload(); }
        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }

        function checkDoc() {
            const isPas = document.getElementById('docType').value === 'Pasaporte';
            document.getElementById('backBox').style.display = isPas ? 'none' : 'block';
        }

        async function saveClient() {
            const btn = document.getElementById('saveBtn');
            const f1 = document.getElementById('fEq').files[0];
            const f2 = document.getElementById('fFr').files[0];
            const f3 = document.getElementById('fBk').files[0];
            const type = document.getElementById('docType').value;

            if(!f1 || !f2 || (type !== 'Pasaporte' && !f3)) {
                return Swal.fire('Error', 'Fotos de documentos incompletas.', 'error');
            }

            btn.disabled = true; btn.innerText = "VERIFICANDO...";
            
            try {
                const read = (f) => new Promise(r => { const fr = new FileReader(); fr.onload = () => r(fr.result); fr.readAsDataURL(f); });
                const img1 = await read(f1); const img2 = await read(f2);
                const img3 = f3 ? await read(f3) : "";

                await db.collection("clientes").add({
                    n: document.getElementById('fn').value, a: document.getElementById('ln').value,
                    doc: document.getElementById('docId').value, tDoc: type,
                    m: parseFloat(document.getElementById('amt').value), cT: parseInt(document.getElementById('ins').value),
                    cP: 0, tel: document.getElementById('tel').value, pais: document.getElementById('country').value,
                    imgE: img1, imgF: img2, imgB: img3,
                    by: localStorage.getItem('role'), date: new Date()
                });
                Swal.fire('Guardado', 'Expediente Sincronizado', 'success').then(()=>location.reload());
            } catch(e) { btn.disabled = false; btn.innerText = "Reintentar"; }
        }

        function init() {
            db.collection("clientes").orderBy("date", "desc").onSnapshot(snap => {
                const list = document.getElementById('mainList');
                const role = localStorage.getItem('role');
                let total = 0; list.innerHTML = "";
                
                snap.forEach(doc => {
                    const d = doc.data(); total += d.m;
                    const pct = Math.round((d.cP / d.cT) * 100);
                    
                    list.innerHTML += `
                        <tr class="glass-card">
                            <td class="p-4">
                                <div class="text-[11px] font-black uppercase text-white">${d.n} ${d.a}</div>
                                <div class="text-[8px] text-blue-400 font-bold uppercase mt-1">Por: ${d.by}</div>
                            </td>
                            <td class="p-4">
                                <div class="flex items-center gap-2">
                                    <div class="flex-1 h-1 bg-white/10 rounded-full overflow-hidden w-12"><div class="h-full bg-blue-600" style="width:${pct}%"></div></div>
                                    <span class="text-[9px] font-bold">${d.cP}/${d.cT}</span>
                                </div>
                            </td>
                            <td class="p-4 text-right">
                                <div class="flex gap-2 justify-end">
                                    <button onclick="view('${doc.id}')" class="w-8 h-8 glass-card text-blue-500 flex items-center justify-center"><i class="fas fa-eye text-xs"></i></button>
                                    ${role === 'ADMIN' ? `<button onclick="del('${doc.id}')" class="w-8 h-8 glass-card text-red-500 flex items-center justify-center"><i class="fas fa-trash text-xs"></i></button>` : ''}
                                </div>
                            </td>
                        </tr>`;
                });
                document.getElementById('totalCap').innerText = "RD$ " + total.toLocaleString();
            });
        }

        async function view(id) {
            const doc = await db.collection("clientes").doc(id).get();
            const d = doc.data();
            Swal.fire({
                title: d.n + ' ' + d.a,
                html: `<div class="grid grid-cols-2 gap-2"><img src="${d.imgF}" class="rounded"> <img src="${d.imgB || d.imgF}" class="rounded"></div>
                       <p class="mt-4 text-[10px] text-left"><b>Documento:</b> ${d.doc}<br><b>Monto:</b> RD$ ${d.m}</p>`,
                background: '#0f172a', color: '#fff'
            });
        }

        async function del(id) {
            const res = await Swal.fire({ title:'¿Borrar?', icon:'warning', showCancelButton:true, confirmButtonColor:'#d33', background:'#0f172a', color:'#fff' });
            if(res.isConfirmed) await db.collection("clientes").doc(id).delete();
        }
        function filtering() { let t = document.getElementById('find').value.toUpperCase(); let r = document.getElementById('mainList').getElementsByTagName('tr'); for(let i=0; i<r.length; i++) r[i].style.display = r[i].innerText.toUpperCase().includes(t) ? "" : "none"; }
    </script>
</body>
</html>
